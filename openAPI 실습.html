
<!DOCTYPE html='ko'>

<html>
    <head>
        <script>
            function change_zero(num) {
                if(num === 0) {return '-';}
                return num;
            }

            function load() {
                const con = confirm("데이터를 불러오시겠습니까?");  //confirm : 데이터를 불러올지 안불러올지
                if(con == false){
                    console.log("데이터를 안불러옵니다");
                    return;
                }
                fetch("http://openapi.seoul.go.kr:8088/71747673467a657235396c54657648/json/RealtimeCityAir/1/25/").then(function(res) {
                    res.json().then(function(res2) {
                        const data = document.getElementById("data");

                        var IDEX_MVL = new Array();
                        var count = 0
                        for(var i =0; i<25; i++){
                            if(res2.RealtimeCityAir.row[i].IDEX_MVL === 0) count=count+1;
                            IDEX_MVL[i] = res2.RealtimeCityAir.row[i].IDEX_MVL;
                            
                        }
                            var IDEX_MVL_sort = IDEX_MVL.sort((a, b) => b - a);
                            var bad = IDEX_MVL_sort[4];
                            var good = IDEX_MVL_sort[20-count]; 
                       
                         for(var i=0; i<25; i++){   
                            const rows = document.createElement('tr');
                            rows.style.display = 'table-row';
                            if (i !== 0 && res2.RealtimeCityAir.row[i].MSRRGN_NM !== res2.RealtimeCityAir.row[i - 1].MSRRGN_NM) {
                                rows.classList.add('border-top');
                            }
                            const msrsteCell = document.createElement('td');
                            const pmtCell = document.createElement('td');
                            const pmfCell = document.createElement('td');
                            const oCell = document.createElement('td');
                            const soCell = document.createElement('td');
                            const idexCell = document.createElement('td');
                            const idexnCell = document.createElement('td');

                            msrsteCell.innerHTML = res2.RealtimeCityAir.row[i].MSRSTE_NM;
                            pmtCell.innerHTML = change_zero(res2.RealtimeCityAir.row[i].PM10);
                            pmfCell.innerHTML = change_zero(res2.RealtimeCityAir.row[i].PM25);
                            oCell.innerHTML = change_zero(res2.RealtimeCityAir.row[i].O3);
                            soCell.innerHTML = change_zero(res2.RealtimeCityAir.row[i].SO2);
                            idexCell.innerHTML = change_zero(res2.RealtimeCityAir.row[i].IDEX_MVL);
                            idexnCell.innerHTML = res2.RealtimeCityAir.row[i].IDEX_NM;

                            if(res2.RealtimeCityAir.row[i].IDEX_MVL >= bad) {
                                idexCell.setAttribute('style', 'font-weight: bold; color: red;');
                            }
                            else if(idexCell.innerHTML !=0 && idexCell.innerHTML <= good) {
                                idexCell.setAttribute('style', 'font-weight: bold; color: blue;');}
                            else { idexCell.setAttribute('style', 'color: black');}

                            if(idexnCell.innerHTML === "좋음") idexnCell.setAttribute('style', 'color: blue');
                            else if(idexnCell.innerHTML === "보통") idexnCell.setAttribute('style', 'color: green');
                            else idexnCell.setAttribute('style', 'color: red'); 

                            rows.appendChild(msrsteCell);
                            rows.appendChild(pmtCell);
                            rows.appendChild(pmfCell);
                            rows.appendChild(oCell);
                            rows.appendChild(soCell);
                            rows.appendChild(idexCell);
                            rows.appendChild(idexnCell);

                            data.appendChild(rows);

                            
                        }

                    });
                    console.log(res);
                });
                
            }
        </script>
        <style>
            #data tr.border-top > td {
                border-top: 2px solid black;
            }
            table {
                text-align: center;
                width: 500px;
            }

            #data td {
                width: 50px;
                border: 1px solid gray;
            }
        </style>
    </head>
    <body>
        <button onclick="load()">데이터 불러오기</button>
        <table>
            <thead>
                <th>지역명</th>
                <th>PM10</th>
                <th>PM25</th>
                <th>O3</th>
                <th>S02</th>
                <th>IDEX_MVL</th>
                <th>IDEX_NM</th>                
            </thead>
            <tbody id="data">
            </tbody>
        </table>
    </body>
</html>